<!DOCTYPE html>
 <html xml:lang="en" lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Venturi Meter Monitoring</title>
     <meta name="description" content="Venturi effect-based venturimeters are widely used to accurately measure fluid flow rates. Learn about its working principles, advantages and applications.">
     <meta name="keywords" content="venturimeter, fluid flow, flow measurement, venturi effect, dynamic fluid, flow meter, fluid monitoring">
     <meta name="author" content="GALIH RIDHO UTOMO, Ana Maulida">
     <meta name="robots" content="index, follow">
     <meta name="google-site-verification" content="OYdjPwgIjGMAbQd3CGwM_l20jLNRRp84mEl3kw06DMg" />
     <link rel="canonical" href="https://4211421036.github.io/flowsense/">
   
     <!-- PWA & Favicon -->
     <link rel="manifest" href="/flowsense/manifest.webmanifest">
     <meta name="theme-color" content="#1E274E">
     <link rel="icon" href="https://4211421036.github.io/flowsense/ven.png" type="image/x-icon">
     <link rel="shortcut icon" href="https://4211421036.github.io/flowsense/ven.png" type="image/x-icon">
   
     <!-- Open Graph (Facebook, LinkedIn, dll) -->
     <meta property="og:title" content="Venturi Meter Monitoring">
     <meta property="og:description" content="Venturi effect-based venturimeters are widely used to accurately measure fluid flow rates. Learn about its working principles, advantages and applications.">
     <meta property="og:image" content="https://4211421036.github.io/flowsense/GraphVen.png">
     <meta property="og:url" content="https://4211421036.github.io/flowsense/">
     <meta property="og:type" content="article">
     <meta property="og:site_name" content="Venturi Meter Monitoring">
     <meta property="article:author" content="GALIH RIDHO UTOMO, Ana Maulida">
     <meta property="article:published_time" content="2025-04-16T10:00:00+00:00">
   
     <!-- Twitter Card -->
     <meta name="twitter:card" content="summary_large_image">
     <meta name="twitter:site" content="@flowsense">
     <meta name="twitter:title" content="Venturi Meter Monitoring">
     <meta name="twitter:description" content="Venturi effect-based venturimeters are widely used to accurately measure fluid flow rates. Learn about its working principles, advantages and applications.">
     <meta name="twitter:image" content="https://4211421036.github.io/flowsense/GraphVen.png">
     <script async src="https://www.googletagmanager.com/gtag/js?id=G-10CPK9SS6N"></script>
     <script>
         window.dataLayer = window.dataLayer || [];
         function gtag() { dataLayer.push(arguments); }
         gtag('js', new Date());
 
         gtag('config', 'G-10CPK9SS6N');
     </script>
   
     <!-- JSON-LD (Schema.org) untuk Google -->
     <script type="application/ld+json">
     {
       "@context": "https://schema.org",
       "@type": "TechArticle",
       "headline": "Venturi Meter Monitoring",
       "datePublished": "2025-04-16T10:00:00+00:00",
       "author": [
         {
           "@type": "Person",
           "name": "GALIH RIDHO UTOMO",
           "url": "https://www.instagram.com/galih_ridho_utomo/",
           "image": "https://avatars.githubusercontent.com/u/92840324?v=4"
         },
         {
           "@type": "Person",
           "name": "Ana Maulida",
           "url": "https://www.instagram.com/anma1505/",
           "image": "https://instagram.fsrg5-3.fna.fbcdn.net/...jpg"
         }
       ],
       "publisher": {
         "@type": "Organization",
         "name": "FlowSense Technology",
         "logo": {
           "@type": "ImageObject",
           "url": "https://4211421036.github.io/flowsense/ven.png"
         }
       },
       "image": "https://4211421036.github.io/flowsense/GraphVen.png",
       "description": "Venturi effect-based venturimeters are widely used to accurately measure fluid flow rates. Learn about its working principles, advantages and applications."
     }
     </script>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://4211421036.github.io/flowsense/">
  
     <script src="https://4211421036.github.io/flowsense/dist/chart.min.js"></script>
     <style>
         :root {
             --primary-bg: #151C35;
             --card-bg: #1E274E;
             --text-color: #FFFFFF;
             --accent-blue: #65d8e4;
             --accent-orange: #ff9900;
             --accent-yellow: #FFD166;
             --accent-red: #cc0000;
             --accent-green: #00b300;
         }
 
         * {
             margin: 0;
             padding: 0;
             box-sizing: border-box;
             font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         }
 
         body {
             background-color: var(--primary-bg);
             color: var(--text-color);
             padding: 15px;
         }
 
         header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 20px;
             padding: 0 10px;
         }
 
         .header-title {
             display: flex;
             align-items: center;
             gap: 10px;
         }
 
         .header-title h1 {
             font-size: 1.5rem;
             font-weight: 600;
         }
 
         .last-update {
             font-size: 0.9rem;
             color: #9DA3B4;
         }
 
         .dashboard {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
             gap: 15px;
         }
 
         .card {
             background-color: var(--card-bg);
             border-radius: 15px;
             padding: 20px;
             position: relative;
             overflow: hidden;
             min-height: 200px;
             display: flex;
             flex-direction: column;
         }
 
         .card-title {
             margin-bottom: 15px;
             font-weight: 500;
             font-size: 1rem;
             color: #9DA3B4;
         }
 
         .card-value {
             font-size: 2.5rem;
             font-weight: 700;
             margin-bottom: 10px;
         }
 
         .card-unit {
             font-size: 1rem;
             vertical-align: super;
             margin-left: 5px;
         }
 
         .card-status {
             display: flex;
             align-items: center;
             gap: 5px;
             margin-top: auto;
         }
 
         .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
 
         .status-text {
             font-size: 0.85rem;
         }
 
         .chart-container {
             flex: 1;
             min-height: 130px;
             position: relative;
         }
 
         .dual-value {
             display: flex;
             justify-content: space-between;
             margin-bottom: 15px;
         }
 
         .value-block {
             display: flex;
             flex-direction: column;
         }
 
         .sensor-label {
             font-size: 0.9rem;
             color: #9DA3B4;
             margin-bottom: 5px;
         }
 
         .sensor-value {
             font-size: 1.8rem;
             font-weight: 600;
         }
 
         .value-unit {
             font-size: 0.9rem;
             vertical-align: super;
             margin-left: 2px;
         }
 
         .chart-dual {
             flex: 1;
             min-height: 130px;
             position: relative;
         }
 
         .dominant-factor {
             margin-top: 5px;
             font-size: 0.8rem;
             color: #9DA3B4;
         }
 
         .gauge-container {
             position: relative;
             width: 100%;
             height: 140px;
             margin: 15px 0;
         }
 
         .gauge-center {
             display: flex;
             flex-direction: column;
             align-items: center;
             justify-content: center;
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             text-align: center;
         }
 
         .gauge-value {
             font-size: 2rem;
             font-weight: 700;
         }
 
         .gauge-label {
             font-size: 0.9rem;
             color: #9DA3B4;
         }
 
         .refresh-button {
             background-color: #2E3755;
             color: white;
             border: none;
             border-radius: 8px;
             padding: 8px 15px;
             cursor: pointer;
             display: flex;
             align-items: center;
             gap: 5px;
             transition: background-color 0.3s;
         }
 
         .refresh-button:hover {
             background-color: #3A4674;
         }
 
         .info-row {
             display: flex;
             align-items: center;
             justify-content: space-between;
             margin-top: 10px;
             color: #9DA3B4;
             font-size: 0.85rem;
         }
 
         @media (max-width: 768px) {
             .dashboard {
                 grid-template-columns: 1fr;
             }
 
             .card-value {
                 font-size: 2rem;
             }
         }
 
         .centered-placeholder {
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
         }
 
         .moon-phase-container {
             display: flex;
             justify-content: center;
             align-items: center;
             height: 120px;
         }
 
         .moon-phase {
             width: 100px;
             height: 100px;
             background-color: var(--accent-yellow);
             border-radius: 50%;
             position: relative;
             overflow: hidden;
         }
 
         .moon-mask {
             position: absolute;
             top: 0;
             right: 0;
             width: 97px;
             height: 100px;
             background-color: var(--card-bg);
             border-radius: 50%;
             transform: translateX(3px);
         }
 
         .diff-value {
             color: var(--accent-blue);
             font-weight: 600;
         }
 
         .flow-value {
             color: var(--accent-green);
             font-weight: 600;
         }
 
         .ratio-value {
             color: var(--accent-yellow);
             font-weight: 600;
         }
 
         .footer-info {
             text-align: center;
             margin-top: 20px;
             color: #9DA3B4;
             font-size: 0.85rem;
         }
 
         /* Loader styling */
         .loader {
             border: 3px solid rgba(255, 255, 255, 0.3);
             border-radius: 50%;
             border-top: 3px solid var(--accent-blue);
             width: 20px;
             height: 20px;
             animation: spin 1s linear infinite;
             display: inline-block;
             margin-right: 10px;
             vertical-align: middle;
         }
 
         @keyframes spin {
             0% { transform: rotate(0deg); }
             100% { transform: rotate(360deg); }
         }
 
         /* Status colors */
         .normal { background-color: var(--accent-green); box-shadow: 0 0 0 2px #fff, 0 0 0 3px #00b300; /* Double border for visibility */ }
         .warning { background-color: var(--accent-yellow); box-shadow: 0 0 0 2px #fff, 0 0 0 3px #ff9900; }
         .alert { background-color: var(--accent-red); box-shadow: 0 0 0 2px #fff, 0 0 0 3px #cc0000;}
         .info { background-color: var(--accent-blue); box-shadow: 0 0 0 2px #fff, 0 0 0 3px #0099cc; }
         ul { padding: 25px; }
      /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
    }
    
    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
    .modal {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-height: 80vh;
        background-color: #1E2746;
        border-radius: 16px 16px 0 0;
        box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        z-index: 1001;
        transform: translateY(100%);
        transition: transform 0.3s ease-out;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        margin: 0 auto;
    }
    
    .modal.active {
        transform: translateY(0);
    }
    
    .modal-header {
        padding: 16px;
        background-color: #2A3655;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-title {
        margin: 0;
        font-size: 18px;
        color: #FFFFFF;
    }
    
    .modal-close {
        background: none;
        border: none;
        color: #9DA3B4;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        line-height: 1;
    }
    
    .modal-content {
        padding: 16px;
        overflow-y: auto;
        flex-grow: 1;
    }
    
    .modal-drag-handle {
        height: 4px;
        width: 40px;
        background-color: rgba(255, 255, 255, 0.3);
        margin: 8px auto;
        border-radius: 2px;
        cursor: ns-resize;
    }
    
    /* Info button on cards */
    .card-info-button {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.1);
        color: #9DA3B4;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        cursor: pointer;
        z-index: 10;
    }
    a {
        color: #0066cc; /* Ensure good contrast ratio */
        text-decoration: underline; /* Always underline links */
        font-weight: 500; /* Slightly bolder than regular text */
    }
    
    a:hover, a:focus {
        text-decoration: double underline; /* Enhanced underline on hover/focus */
        outline: 2px solid currentColor; /* Outline for focus state */
        outline-offset: 2px;
    }
    
    /* Responsive styles */
    @media (min-width: 768px) {
        .modal {
            left: 50%;
            bottom: auto;
            top: 50%;
            width: 90%;
            max-width: 500px;
            transform: translate(-50%, -50%) scale(0.9);
            border-radius: 16px;
            max-height: 80vh;
            opacity: 0;
            visibility: hidden;
        }
        
        .modal.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }
        
        .modal-drag-handle {
            display: none;
        }
    }
      /* Card styles for modal interaction */
.card.active-card {
    position: relative;
    z-index: 1001 !important;
    box-shadow: 0 8px 20px rgba(0, 0, 255, 0.3);
    transition: all 0.3s ease;
}

/* Card highlight animation */
@keyframes cardHighlight {
    0% { 
        box-shadow: 0 0 0 rgba(0, 0, 255, 0.1); 
        transform: translateY(0); 
    }
    100% { 
        box-shadow: 0 8px 20px rgba(0, 0, 255, 0.3); 
        transform: translateY(-10px); 
    }
}

.card-clone {
    position: fixed !important;
    z-index: 1001 !important;
    box-shadow: 0 8px 20px rgba(0, 0, 255, 0.3);
    transition: all 0.3s ease;
    background-color: inherit;
    border-radius: inherit;
    /* Ensure charts inside clone are visible */
    opacity: 1;
    visibility: visible;
}

.card-clone canvas {
    /* Make sure canvas elements inside clone are visible */
    display: block !important;
    opacity: 1 !important;
}

.modal.active {
    z-index: 1000;
}

.modal-overlay.active {
    z-index: 999;
}

/* Hide the original card when cloned */
.card.being-cloned {
    visibility: hidden;
}
      .skip-link {
            position: absolute;
            left: -9999px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
            z-index: 9999;
            background: #0056b3;
            color: white;
            padding: 8px;
            border-radius: 4px;
        }
        .skip-link:focus {
            left: 10px;
            top: 10px;
            width: auto;
            height: auto;
            overflow: visible;
        }

        /* Visually hidden utility class for screen readers */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for keyboard navigation */
        :focus {
            outline: 3px solid #0056b3;
            outline-offset: 2px;
            border-radius: 20px;
        }

      #loadingProgress {
        position: sticky;
        top: 0;
        left: 0;
        z-index: 1000;
        height: 3px;
        width: 0%;
        background-color: #65D8E4;
        transition: width 0.3s ease;
    }
    
    #loadingProgress[aria-busy="true"] {
        width: 80%; /* Show partial progress when busy */
    }
    
    #loadingProgress[aria-busy="false"] {
        transition: width 0.5s ease;
    }
      .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modals {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 320px;
            max-width: 90%;
            overflow: hidden;
        }
        
        .modals-header {
            padding: 16px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eee;
        }
        
        .app-logo {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 12px;
            background-color: #4285f4;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }
        
        .app-info h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .app-info p {
            font-size: 13px;
            color: #666;
        }
        
        .modals-body {
            padding: 16px;
        }
        
        .modals-body p {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }
        
        .modals-footer {
            padding: 12px 16px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 1px solid #eee;
        }
        
        .btn {
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        
        .btn-cancel {
            background-color: transparent;
            color: #4285f4;
        }
        
        .btn-cancel:hover {
            background-color: #f0f0f0;
        }
        
        .btn-install {
            background-color: #4285f4;
            color: white;
        }
        
        .btn-install:hover {
            background-color: #2d76e7;
        }
        
        .hidden {
            display: none;
        }
     </style>
 </head>
 <body>
     <nav aria-label="Skip navigation">
    <a href="#main-content" class="skip-link" accesskey="s">Skip to main content</a>
</nav>

<header role="banner">
    <div class="header-title">
        <h1>Venturi Meter Monitoring</h1>
        <div class="last-update" id="lastUpdate" aria-live="polite" aria-atomic="true">12:09 PM</div>
    </div>
    <button class="refresh-button" onclick="fetchData()" aria-label="Refresh data" accesskey="r">
        <span id="refreshIcon" aria-label="Refresh data" class="refresh-icon" aria-hidden="true">↻</span>
        <span id="refreshTooltip" role="tooltip" class="tooltip">Refresh</span>
    </button>
</header>

<!-- Add this progress bar element -->
<div id="loadingProgress" role="progressbar" aria-label="Loading data" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-busy="false" style="height: 3px; width: 0%; background-color: #65D8E4; transition: width 0.3s ease;"></div>

<main id="main-content" role="main" tabindex="-1">
    <!-- Removed incorrect role="menuitem" -->
    <div class="dashboard" aria-label="Dashboard panels">
        <!-- Pressure 1 Card -->
        <section class="card" aria-labelledby="pressure1-title" aria-describedby="pressure1-desc">
            <h2 class="card-title" id="pressure1-title">Pressure 1</h2>
            <div id="pressure1-desc" class="visually-hidden">Pressure reading from sensor 1</div>
            <div class="card-value">
                <span id="pressure1Value" aria-live="polite" aria-atomic="true">0.00</span>
                <span class="card-unit">Pa</span>
            </div>
            <div class="chart-container">
                <canvas id="pressure1Chart" aria-label="Pressure 1 over time chart" role="img">
                    <p role="text">Graph showing pressure 1 measurements over time</p>
                </canvas>
            </div>
            <div class="card-status">
                <div class="status-indicator normal" id="pressure1Status" aria-hidden="true"></div>
                <div class="status-text" id="pressure1StatusText" aria-live="polite" aria-atomic="true">Stable</div>
            </div>
        </section>

        <!-- Pressure 2 Card -->
        <section class="card" aria-labelledby="pressure2-title" aria-describedby="pressure2-desc">
            <h2 class="card-title" id="pressure2-title">Pressure 2</h2>
            <div id="pressure2-desc" class="visually-hidden">Pressure reading from sensor 2</div>
            <div class="card-value">
                <span id="pressure2Value" aria-live="polite" aria-atomic="true">0.00</span>
                <span class="card-unit">Pa</span>
            </div>
            <div class="chart-container">
                <canvas id="pressure2Chart" aria-label="Pressure 2 over time chart" role="img">
                    <p role="text">Graph showing pressure 2 measurements over time</p>
                </canvas>
            </div>
            <div class="card-status">
                <div class="status-indicator normal" id="pressure2Status" aria-hidden="true"></div>
                <div class="status-text" id="pressure2StatusText" aria-live="polite" aria-atomic="true">Stable</div>
            </div>
        </section>

        <!-- Differential Pressure Card -->
        <section class="card" aria-labelledby="diffPressure-title" aria-describedby="diffPressure-desc">
            <h2 class="card-title" id="diffPressure-title">Differential Pressure</h2>
            <div id="diffPressure-desc" class="visually-hidden">Difference between pressure 1 and pressure 2</div>
            <div class="card-value">
                <span id="diffPressureValue" aria-live="polite" aria-atomic="true">0.00</span>
                <span class="card-unit">Pa</span>
            </div>
            <div class="chart-container">
                <canvas id="diffPressureChart" aria-label="Differential pressure over time chart" role="img">
                    <p role="text">Graph showing differential pressure measurements over time</p>
                </canvas>
            </div>
            <div class="card-status">
                <div class="status-indicator info" id="diffStatus" aria-hidden="true"></div>
                <div class="status-text" id="diffStatusText" aria-live="polite" aria-atomic="true">Normal differential</div>
            </div>
        </section>

        <!-- Flow Rate Card -->
        <section class="card" aria-labelledby="flowRate-title" aria-describedby="flowRate-desc">
            <h2 class="card-title" id="flowRate-title">Flow Rate</h2>
            <div id="flowRate-desc" class="visually-hidden">Calculated flow rate through the venturi meter</div>
            <div class="card-value">
                <span id="flowRateValue" aria-live="polite" aria-atomic="true">0.00</span>
                <span class="card-unit">L/min</span>
            </div>
            <div class="chart-container">
                <canvas id="flowRateChart" aria-label="Flow rate over time chart" role="img">
                    <p role="text">Graph showing flow rate measurements over time</p>
                </canvas>
            </div>
            <div class="card-status">
                <div class="status-indicator normal" id="flowStatus" aria-hidden="true"></div>
                <div class="status-text" id="flowStatusText" aria-live="polite" aria-atomic="true">Normal flow</div>
            </div>
        </section>

        <!-- Pressure Comparison -->
        <section class="card" aria-labelledby="pressureComp-title" aria-describedby="pressureComp-desc">
            <h2 class="card-title" id="pressureComp-title">Pressure Comparison</h2>
            <div id="pressureComp-desc" class="visually-hidden">Comparison between pressure sensor 1 and pressure sensor 2</div>
            <div class="dual-value">
                <div class="value-block">
                    <h3 class="sensor-label">Sensor 1</h3>
                    <div class="sensor-value">
                        <span id="compPressure1" aria-live="polite" aria-atomic="true">0.00</span>
                        <span class="value-unit">Pa</span>
                    </div>
                </div>
                <div class="value-block">
                    <h3 class="sensor-label">Sensor 2</h3>
                    <div class="sensor-value">
                        <span id="compPressure2" aria-live="polite" aria-atomic="true">0.00</span>
                        <span class="value-unit">Pa</span>
                    </div>
                </div>
            </div>
            <div class="chart-dual">
                <canvas id="pressureCompChart" aria-label="Pressure comparison chart" role="img">
                    <p role="text">Graph comparing pressure measurements from both sensors</p>
                </canvas>
            </div>
            <div class="dominant-factor">
                Difference: <span class="diff-value" id="pressureDiffText" aria-live="polite" aria-atomic="true">0.00 Pa</span>
            </div>
        </section>

        <!-- Flow Rate Gauge -->
        <section class="card" aria-labelledby="flowGauge-title" aria-describedby="flowGauge-desc">
            <h2 class="card-title" id="flowGauge-title">Flow Rate Gauge</h2>
            <div id="flowGauge-desc" class="visually-hidden">Visual gauge showing current flow rate</div>
            <div class="gauge-container" role="meter" aria-labelledby="flowGauge-title" aria-valuenow="0" aria-valuemin="0" aria-valuemax="10">
                <canvas id="flowGauge" aria-label="Flow rate gauge visualization" role="img">
                    <p role="text">Gauge visualization of current flow rate</p>
                </canvas>
                <div class="gauge-center">
                    <div class="gauge-value" id="gaugeFlowValue" aria-live="polite" aria-atomic="true">0.00</div>
                    <div class="gauge-label">L/min</div>
                </div>
            </div>
            <div class="info-row">
                <span>Min: <span id="minFlow" aria-live="polite" aria-atomic="true">0.00</span> L/min</span>
                <span>Max: <span id="maxFlow" aria-live="polite" aria-atomic="true">10.00</span> L/min</span>
            </div>
        </section>

        <!-- Efficiency Card -->
        <section class="card" aria-labelledby="efficiency-title" aria-describedby="efficiency-desc">
            <h2 class="card-title" id="efficiency-title">Venturi Efficiency</h2>
            <div id="efficiency-desc" class="visually-hidden">Efficiency percentage calculated from pressure recovery</div>
            <div class="gauge-container" role="meter" aria-labelledby="efficiency-title" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <canvas id="efficiencyGauge" aria-label="Venturi efficiency gauge visualization" role="img">
                    <p role="text">Gauge visualization of venturi efficiency</p>
                </canvas>
                <div class="gauge-center">
                    <div class="gauge-value" id="efficiencyValue" aria-live="polite" aria-atomic="true">0</div>
                    <div class="gauge-label">%</div>
                </div>
            </div>
            <div class="info-row">
                <span>Calculated from pressure recovery</span>
            </div>
        </section>

        <!-- Reynolds Number -->
        <section class="card" aria-labelledby="reynolds-title" aria-describedby="reynolds-desc">
            <h2 class="card-title" id="reynolds-title">Reynolds Number</h2>
            <div id="reynolds-desc" class="visually-hidden">Dimensionless number indicating flow characteristics</div>
            <div class="card-value">
                <span id="reynoldsValue" aria-live="polite" aria-atomic="true">0</span>
            </div>
            <div class="chart-container">
                <canvas id="reynoldsChart" aria-label="Reynolds number over time chart" role="img">
                    <p role="text">Graph showing Reynolds number measurements over time</p>
                </canvas>
            </div>
            <div class="card-status">
                <div class="status-indicator info" id="flowTypeStatus" aria-hidden="true"></div>
                <div class="status-text" id="flowTypeText" aria-live="polite" aria-atomic="true">Laminar Flow</div>
            </div>
        </section>

        <!-- System Status -->
        <section class="card" aria-labelledby="systemStatus-title" aria-describedby="systemStatus-desc">
            <h2 class="card-title" id="systemStatus-title">System Status</h2>
            <div id="systemStatus-desc" class="visually-hidden">Current status of monitoring system components</div>
            <div class="dual-value">
                <div class="value-block">
                    <h3 class="sensor-label">Sensor 1</h3>
                    <div class="sensor-value">
                        <span id="sensor1Status" aria-live="polite" aria-atomic="true">OK</span>
                    </div>
                </div>
                <div class="value-block">
                    <h3 class="sensor-label">Sensor 2</h3>
                    <div class="sensor-value">
                        <span id="sensor2Status" aria-live="polite" aria-atomic="true">OK</span>
                    </div>
                </div>
            </div>
            <div class="info-row" style="margin-top: 20px;">
                <span>Device Uptime: <span id="uptime" aria-live="polite" aria-atomic="true">0</span> minutes</span>
            </div>
            <div class="info-row">
                <span>Last Data: <span id="lastDataTime" aria-live="polite" aria-atomic="true">N/A</span></span>
            </div>
            <div class="info-row">
                <span>Samples: <span id="sampleCount" aria-live="polite" aria-atomic="true">0</span></span>
            </div>
        </section>

        <!-- Configuration Info -->
        <section class="card" aria-labelledby="config-title" aria-describedby="config-desc">
            <h2 class="card-title" id="config-title">Configuration</h2>
            <div id="config-desc" class="visually-hidden">Venturi meter physical configuration parameters</div>
            <dl class="info-row">
                <dt>Venturi Type:</dt>
                <dd id="venturiType">DOUBLE_PIPE</dd>
            </dl>
            <dl class="info-row">
                <dt>Main Pipe Diameter:</dt>
                <dd id="mainDiameter">20.0 mm</dd>
            </dl>
            <dl class="info-row">
                <dt>Throat Diameter:</dt>
                <dd id="throatDiameter">10.0 mm</dd>
            </dl>
            <dl class="info-row">
                <dt>Area Ratio:</dt>
                <dd class="ratio-value" id="areaRatio">4.00</dd>
            </dl>
        </section>
    </div>
</main>

<div class="modal-overlay" id="modalOverlay" role="dialog" aria-hidden="true" style="display: none;"></div>

<!-- Modal Template -->
<div class="modal" id="infoModal" role="dialog" aria-labelledby="modalTitle" aria-describedby="modalDesc" aria-modal="true" aria-hidden="true" style="display: none;">
    <div class="modal-drag-handle" aria-hidden="true"></div>
    <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Chart Information</h3>
        <div id="modalDesc" class="visually-hidden">Detailed information about the current chart</div>
        <button class="modal-close" id="modalClose" aria-label="Close dialog">&times;</button>
    </div>
    <div class="modal-content" id="modalContent">
        <!-- Content will be inserted here -->
    </div>
</div>

<div class="overlay" id="installModal">
        <div class="modals">
            <div class="modals-header">
                <div class="app-logo">A</div>
                <div class="app-info">
                    <h3>Aplikasi Saya</h3>
                    <p>Developer: Nama Pengembang</p>
                </div>
            </div>
            <div class="modals-body">
                <p>Instal aplikasi ini untuk akses lebih cepat dan pengalaman pengguna yang lebih baik. Aplikasi ini membutuhkan ruang penyimpanan minimal.</p>
            </div>
            <div class="modals-footer">
                <button class="btn btn-cancel" id="cancelBtn">Batal</button>
                <button class="btn btn-install" id="installBtn">Instal</button>
            </div>
        </div>
    </div>

<footer role="contentinfo" class="footer-info">
    <p role="text">Venturi Meter Monitoring System | Last Updated: <span id="footerLastUpdate" aria-live="polite" aria-atomic="true">12:09 PM</span></p>
</footer>
 
     <script>
         // Initialize charts with empty data
         const chartOptions = {
             responsive: true,
             maintainAspectRatio: false,
             scales: {
                 x: {
                     display: false
                 },
                 y: {
                     beginAtZero: false,
                     grid: {
                         color: 'rgba(255, 255, 255, 0.1)'
                     },
                     ticks: {
                         color: '#9DA3B4',
                         font: {
                             size: 10
                         }
                     }
                 }
             },
             plugins: {
                 legend: {
                     display: false
                 }
             },
             elements: {
                 line: {
                     tension: 0.4
                 },
                 point: {
                     radius: 0
                 }
             },
             animation: {
                 duration: 1000
             }
         };
 
         const commonGaugeOptions = {
             responsive: true,
             maintainAspectRatio: false,
             plugins: {
                 legend: {
                     display: false
                 }
             },
             circumference: 180,
             rotation: 270,
             cutout: '70%'
         };
 
         // Initialize colors
         const colors = {
             blue: '#65D8E4',
             orange: '#FF9F45',
             yellow: '#FFD166',
             green: '#06D6A0',
             red: '#EF476F',
             purple: '#9B5DE5'
         };
 
         // Create empty charts
         let pressure1Chart, pressure2Chart, diffPressureChart, flowRateChart;
         let pressureCompChart, flowGauge, efficiencyGauge, reynoldsChart;
 
         // Create time labels (last 10 readings)
         const timeLabels = Array(10).fill().map((_, i) => (i + 1).toString());
 
         // Create empty datasets
         const emptyData = Array(10).fill(null);
 
         // Initialize all charts
         function initCharts() {
             // Single line charts
             pressure1Chart = createLineChart('pressure1Chart', colors.blue);
             pressure2Chart = createLineChart('pressure2Chart', colors.green);
             diffPressureChart = createLineChart('diffPressureChart', colors.yellow);
             flowRateChart = createLineChart('flowRateChart', colors.orange);
             reynoldsChart = createLineChart('reynoldsChart', colors.purple);
 
             // Comparison chart
             pressureCompChart = new Chart(document.getElementById('pressureCompChart'), {
                 type: 'line',
                 data: {
                     labels: timeLabels,
                     datasets: [
                         {
                             label: 'Pressure 1',
                             data: emptyData,
                             borderColor: colors.blue,
                             backgroundColor: colors.blue + '20',
                             fill: true
                         },
                         {
                             label: 'Pressure 2',
                             data: emptyData,
                             borderColor: colors.green,
                             backgroundColor: colors.green + '20',
                             fill: true
                         }
                     ]
                 },
                 options: {
                     ...chartOptions,
                     plugins: {
                         legend: {
                             display: true,
                             position: 'top',
                             labels: {
                                 color: '#9DA3B4',
                                 boxWidth: 10,
                                 font: {
                                     size: 10
                                 }
                             }
                         }
                     }
                 }
             });
 
             // Flow Gauge
             flowGauge = new Chart(document.getElementById('flowGauge'), {
                 type: 'doughnut',
                 data: {
                     labels: ['Flow', 'Remaining'],
                     datasets: [{
                         data: [0, 100],
                         backgroundColor: [
                             createGradient(document.getElementById('flowGauge'), colors.blue, colors.green),
                             'rgba(30, 39, 78, 0.3)'
                         ],
                         borderWidth: 0
                     }]
                 },
                 options: commonGaugeOptions
             });
 
             // Efficiency Gauge
             efficiencyGauge = new Chart(document.getElementById('efficiencyGauge'), {
                 type: 'doughnut',
                 data: {
                     labels: ['Efficiency', 'Remaining'],
                     datasets: [{
                         data: [0, 100],
                         backgroundColor: [
                             createGradient(document.getElementById('efficiencyGauge'), colors.yellow, colors.orange),
                             'rgba(30, 39, 78, 0.3)'
                         ],
                         borderWidth: 0
                     }]
                 },
                 options: commonGaugeOptions
             });
         }
 
         // Helper function to create a linear gradient for gauges
         function createGradient(ctx, colorStart, colorEnd) {
             const canvas = ctx.getContext('2d');
             const gradient = canvas.createLinearGradient(0, 0, 0, 180);
             gradient.addColorStop(0, colorEnd);
             gradient.addColorStop(1, colorStart);
             return gradient;
         }
        // Add these helper functions to control the progress bar
        function showProgress() {
            const progressBar = document.getElementById('loadingProgress');
            progressBar.setAttribute('aria-busy', 'true');
            progressBar.style.width = '80%';
            progressBar.setAttribute('aria-valuenow', '80');
        }
        
        function hideProgress() {
            const progressBar = document.getElementById('loadingProgress');
            progressBar.setAttribute('aria-busy', 'false');
            progressBar.style.width = '100%';
            progressBar.setAttribute('aria-valuenow', '100');
            
            // Reset after animation completes
            setTimeout(() => {
                progressBar.style.width = '0%';
                progressBar.setAttribute('aria-valuenow', '0');
            }, 500);
        }
        
        function showErrorProgress() {
            const progressBar = document.getElementById('loadingProgress');
            progressBar.style.backgroundColor = '#EF476F';
            progressBar.setAttribute('aria-busy', 'false');
            progressBar.style.width = '100%';
            progressBar.setAttribute('aria-valuenow', '100');
            
            // Reset after animation completes
            setTimeout(() => {
                progressBar.style.width = '0%';
                progressBar.style.backgroundColor = '#65D8E4';
                progressBar.setAttribute('aria-valuenow', '0');
            }, 1000);
        }
 
         // Helper function to create line charts
         function createLineChart(elementId, color) {
             return new Chart(document.getElementById(elementId), {
                 type: 'line',
                 data: {
                     labels: timeLabels,
                     datasets: [{
                         data: emptyData,
                         borderColor: color,
                         backgroundColor: color + '20',
                         fill: true
                     }]
                 },
                 options: chartOptions
             });
         }
 
         // Update chart with new data
         function updateChart(chart, newData) {
             chart.data.datasets[0].data = newData;
             chart.update();
         }
 
         // Update comparison chart with new data
         function updateCompChart(chart, data1, data2) {
             chart.data.datasets[0].data = data1;
             chart.data.datasets[1].data = data2;
             chart.update();
         }
 
         // Update gauge chart with new percentage
         function updateGauge(gauge, percentage) {
             gauge.data.datasets[0].data = [percentage, 100 - percentage];
             gauge.update();
         }
 
         // Sample data for demonstration (will be replaced with actual data)
         let sampleHistoryPressure1 = [100.5, 101.2, 100.8, 101.5, 102.0, 101.8, 101.3, 101.0, 100.7, 101.2];
         let sampleHistoryPressure2 = [80.2, 80.5, 80.1, 79.8, 80.0, 80.4, 80.6, 80.3, 80.1, 79.9];
         let sampleHistoryDiff = sampleHistoryPressure1.map((p1, i) => p1 - sampleHistoryPressure2[i]);
         let sampleHistoryFlow = sampleHistoryDiff.map(diff => Math.sqrt(diff) * 0.8);
         let sampleHistoryReynolds = sampleHistoryFlow.map(flow => flow * 1000);
 
         let dataHistory = {
             pressure1: sampleHistoryPressure1,
             pressure2: sampleHistoryPressure2,
             diffPressure: sampleHistoryDiff,
             flowRate: sampleHistoryFlow,
             reynolds: sampleHistoryReynolds
         };
 
         // Current values
         let currentData = {
             pressure1: 101.2,
             pressure2: 79.9,
             diffPressure: 21.3,
             flowRate: 3.68,
             reynolds: 3680,
             efficiency: 85,
             uptime: 120,
             sampleCount: 350
         };
 
         // Configuration values
         const config = {
             venturiType: "DOUBLE_PIPE",
             mainDiameter: 20.0,
             throatDiameter: 10.0,
             areaRatio: 4.0
         };
 
         // Update all displayed values
         function updateDisplayedValues() {
             // Update main values
             document.getElementById('pressure1Value').textContent = currentData.pressure1.toFixed(2);
             document.getElementById('pressure2Value').textContent = currentData.pressure2.toFixed(2);
             document.getElementById('diffPressureValue').textContent = currentData.diffPressure.toFixed(2);
             document.getElementById('flowRateValue').textContent = currentData.flowRate.toFixed(2);
             document.getElementById('reynoldsValue').textContent = Math.round(currentData.reynolds);
 
             // Update comparison values
             document.getElementById('compPressure1').textContent = currentData.pressure1.toFixed(2);
             document.getElementById('compPressure2').textContent = currentData.pressure2.toFixed(2);
             document.getElementById('pressureDiffText').textContent = currentData.diffPressure.toFixed(2) + " Pa";
 
             // Update gauge values
             document.getElementById('gaugeFlowValue').textContent = currentData.flowRate.toFixed(2);
             document.getElementById('efficiencyValue').textContent = currentData.efficiency;
 
             // Update flow type text based on Reynolds number
             const flowTypeElement = document.getElementById('flowTypeText');
             if (currentData.reynolds < 2000) {
                 flowTypeElement.textContent = "Laminar Flow";
                 document.getElementById('flowTypeStatus').className = "status-indicator normal";
             } else if (currentData.reynolds < 4000) {
                 flowTypeElement.textContent = "Transitional Flow";
                 document.getElementById('flowTypeStatus').className = "status-indicator warning";
             } else {
                 flowTypeElement.textContent = "Turbulent Flow";
                 document.getElementById('flowTypeStatus').className = "status-indicator info";
             }
 
             // Update system status
             document.getElementById('uptime').textContent = currentData.uptime;
             document.getElementById('sampleCount').textContent = currentData.sampleCount;
 
             // Update configuration
             document.getElementById('venturiType').textContent = config.venturiType;
             document.getElementById('mainDiameter').textContent = config.mainDiameter.toFixed(1) + " mm";
             document.getElementById('throatDiameter').textContent = config.throatDiameter.toFixed(1) + " mm";
             document.getElementById('areaRatio').textContent = config.areaRatio.toFixed(2);
 
             // Update last update time
             const now = new Date();
             const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
             document.getElementById('lastUpdate').textContent = timeString;
             document.getElementById('footerLastUpdate').textContent = timeString;
             document.getElementById('lastDataTime').textContent = timeString;
         }
 
         // Update all charts
         function updateAllCharts() {
             updateChart(pressure1Chart, dataHistory.pressure1);
             updateChart(pressure2Chart, dataHistory.pressure2);
             updateChart(diffPressureChart, dataHistory.diffPressure);
             updateChart(flowRateChart, dataHistory.flowRate);
             updateChart(reynoldsChart, dataHistory.reynolds);
 
             updateCompChart(pressureCompChart, dataHistory.pressure1, dataHistory.pressure2);
 
             // Calculate percentage for flow gauge (assuming max is 10 L/min)
             const flowPercentage = Math.min(currentData.flowRate / 10 * 100, 100);
             updateGauge(flowGauge, flowPercentage);
 
             // Update efficiency gauge
             updateGauge(efficiencyGauge, currentData.efficiency);
         }
 
         // Fetch data from API endpoint
         async function fetchData() {
             try {
                 // Show loading state
                 document.getElementById('refreshIcon').innerHTML = '<div class="loader"></div>';
                 showProgress();
 
                 // Fetch data from GitHub Pages JSON file
                 const response = await fetch('/flowsense/venturi_data.json');
                 if (!response.ok) {
                     throw new Error('Network response was not ok');
                 }
 
                 const data = await response.json();
 
                 // Process the data
                 processData(data);
                 
                 // Complete progress
                 hideProgress();
 
                 // Reset refresh button
                 document.getElementById('refreshIcon').innerHTML = '↻';
             } catch (error) {
                 console.error('Error fetching data:', error);
                 alert('Failed to fetch data. Using sample data instead.');
                 showErrorProgress();
 
                 // Use sample data instead
                 useSampleData();
 
                 // Reset refresh button
                 document.getElementById('refreshIcon').innerHTML = '↻';
             }
         }
 
         // Process the fetched data
         function processData(data) {
             // Extract the latest data point
             const latestData = data.readings[data.readings.length - 1];
 
             // Update current values
             currentData = {
                 pressure1: parseFloat(latestData.pressure1),
                 pressure2: parseFloat(latestData.pressure2),
                 diffPressure: parseFloat(latestData.pressureDiff),
                 flowRate: parseFloat(latestData.flowRate),
                 reynolds: calculateReynolds(parseFloat(latestData.flowRate)),
                 efficiency: calculateEfficiency(parseFloat(latestData.pressure1), parseFloat(latestData.pressure2)),
                 uptime: data.uptime || 0,
                 sampleCount: data.readings.length
             };
 
             // Extract history for charts (last 10 readings or all if less than 10)
             const historyLength = Math.min(data.readings.length, 10);
             const historyData = data.readings.slice(-historyLength);
 
             dataHistory = {
                 pressure1: historyData.map(item => parseFloat(item.pressure1)),
                 pressure2: historyData.map(item => parseFloat(item.pressure2)),
                 diffPressure: historyData.map(item => parseFloat(item.pressureDiff)),
                 flowRate: historyData.map(item => parseFloat(item.flowRate)),
                 reynolds: historyData.map(item => calculateReynolds(parseFloat(item.flowRate)))
             };
 
             // Update configuration if available
             if (data.config) {
                 config.venturiType = data.config.venturiType || config.venturiType;
                 config.mainDiameter = data.config.mainDiameter || config.mainDiameter;
                 config.throatDiameter = data.config.throatDiameter || config.throatDiameter;
                 config.areaRatio = (config.mainDiameter / config.throatDiameter) ** 2;
             }
 
             // Update UI
             updateDisplayedValues();
             updateAllCharts();
         }
 
         // Calculate Reynolds number based on flow rate
         function calculateReynolds(flowRate) {
             // Constants for water at room temperature
             const density = 998; // kg/m³
             const viscosity = 0.001; // Pa·s
             const diameter = config.throatDiameter / 1000; // Convert mm to m
 
             // Convert flow rate from L/min to m³/s
             const flowRateM3S = flowRate / (60 * 1000);
 
             // Calculate velocity in throat
             const area = Math.PI * (diameter/2) ** 2;
             const velocity = flowRateM3S / area;
 
             // Calculate Reynolds number
             return (density * velocity * diameter) / viscosity;
         }
 
         // Calculate venturi efficiency based on pressure recovery
         function calculateEfficiency(p1, p2) {
             // Theoretical efficiency calculation
             // This is a simplified model - in a real system you would use pressure recovery
             const beta = config.throatDiameter / config.mainDiameter;
             const theoreticalEfficiency = 98 - 2 * (1 - beta);
 
             // Add some random variation for demonstration
             const variation = Math.sin(Date.now() / 10000) * 5;
             return Math.round(theoreticalEfficiency + variation);
         }
 
         // Use sample data for demonstration
         function useSampleData() {
             // Update UI with sample data
             updateDisplayedValues();
             updateAllCharts();
         }
 
         // Initialize on page load
         window.onload = function() {
             initCharts();
             useSampleData(); // Start with sample data
             fetchData(); // Then try to fetch real data
 
             // Set up auto-refresh every 30 seconds
             setInterval(fetchData, 30000);
         };
     </script>
    <script>
        // Tampilkan modal secara otomatis ketika halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Tunggu sebentar sebelum menampilkan modal
            setTimeout(function() {
                document.getElementById('installModal').classList.remove('hidden');
            }, 1000);
        });
        
        // Tombol Batal untuk menutup modal
        document.getElementById('cancelBtn').addEventListener('click', function() {
            document.getElementById('installModal').classList.add('hidden');
        });
        
        // Tombol Instal
        document.getElementById('installBtn').addEventListener('click', function() {
            alert('Memulai proses instalasi aplikasi...');
            document.getElementById('installModal').classList.add('hidden');
            
            // Di sini Anda dapat menambahkan kode untuk menangani proses instalasi PWA
            // jika aplikasi Anda adalah Progressive Web App
        });
        
        // Jika ingin mengintegrasikan dengan Service Worker dari kode yang Anda berikan
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/flowsense/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
        
        // Check for updates when coming back online
        window.addEventListener('online', () => {
            console.log('Kembali online, memeriksa pembaruan');
            // fetchData(); // Uncomment jika Anda memiliki fungsi fetchData
        });
        
        // Untuk PWA, Anda bisa mendeteksi apakah aplikasi dapat diinstal
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            // Simpan event untuk digunakan nanti
            let deferredPrompt = e;
            
            // Tambahkan event listener ke tombol instal
            document.getElementById('installBtn').addEventListener('click', () => {
                // Tampilkan prompt instalasi
                deferredPrompt.prompt();
                
                // Tunggu pengguna merespons prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Pengguna menerima prompt instalasi');
                    } else {
                        console.log('Pengguna menolak prompt instalasi');
                    }
                    // Clear the saved prompt
                    deferredPrompt = null;
                });
            });
        });
    </script>
<script>
    const modalOverlay = document.getElementById('modalOverlay');
const infoModal = document.getElementById('infoModal');
const modalTitle = document.getElementById('modalTitle');
const modalContent = document.getElementById('modalContent');
const modalClose = document.getElementById('modalClose');
const modalDragHandle = document.querySelector('.modal-drag-handle');

// Track the currently active card
let activeCard = null;
let originalCardPosition = null;
let isMobile = window.innerWidth <= 768; // Mobile detection
    
    // Chart information content
    const chartInfo = {
        pressure1: {
            title: "Pressure 1 Information",
            content: `
                <p role="text">This chart shows the pressure readings from Sensor 1 in Pascals (Pa).</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>The Y-axis shows the pressure value</li>
                    <li>The X-axis shows the most recent 10 readings</li>
                    <li>A stable line indicates consistent pressure</li>
                    <li>Fluctuations may indicate system changes or issues</li>
                </ul>
                <p role="text"><strong>Normal Range:</strong> Typically between 90-110 Pa for this system</p>
            `
        },
        pressure2: {
            title: "Pressure 2 Information",
            content: `
                <p role="text">This chart shows the pressure readings from Sensor 2 in Pascals (Pa).</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>The Y-axis shows the pressure value</li>
                    <li>The X-axis shows the most recent 10 readings</li>
                    <li>This sensor should show lower pressure than Sensor 1</li>
                    <li>Compare with Pressure 1 to see the differential</li>
                </ul>
                <p role="text"><strong>Normal Range:</strong> Typically between 75-85 Pa for this system</p>
            `
        },
        diffPressure: {
            title: "Differential Pressure Information",
            content: `
                <p role="text">This chart shows the difference between Pressure 1 and Pressure 2.</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>Calculated as Pressure 1 minus Pressure 2</li>
                    <li>Directly relates to flow rate through the Venturi</li>
                    <li>Larger differences indicate higher flow rates</li>
                    <li>Sudden drops may indicate blockages</li>
                </ul>
                <p role="text"><strong>Normal Range:</strong> Typically between 15-25 Pa for normal operation</p>
            `
        },
        flowRate: {
            title: "Flow Rate Information",
            content: `
                <p role="text">This chart shows the calculated flow rate in liters per minute (L/min).</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>Calculated from the differential pressure</li>
                    <li>Follows the square root of the pressure difference</li>
                    <li>Higher values indicate more fluid moving through</li>
                    <li>Zero flow shows when system is off</li>
                </ul>
                <p role="text"><strong>Normal Range:</strong> Typically between 2-5 L/min for normal operation</p>
            `
        },
        pressureComp: {
            title: "Pressure Comparison Information",
            content: `
                <p role="text">This chart compares both pressure sensors simultaneously.</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>Blue line shows Pressure 1 (upstream)</li>
                    <li>Green line shows Pressure 2 (throat)</li>
                    <li>The gap between lines represents differential pressure</li>
                    <li>Both should move somewhat in sync</li>
                </ul>
                <p role="text"><strong>Note:</strong> Pressure 2 should always be lower than Pressure 1 in a Venturi system.</p>
            `
        },
        flowGauge: {
            title: "Flow Rate Gauge Information",
            content: `
                <p role="text">This gauge provides a visual representation of the current flow rate.</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>The needle position shows current flow rate</li>
                    <li>Green indicates normal operating range</li>
                    <li>Approaching max may indicate high flow conditions</li>
                    <li>Min and max values are shown below</li>
                </ul>
                <p role="text"><strong>Normal Range:</strong> Typically in the middle range (30-70%) during normal operation</p>
            `
        },
        efficiency: {
            title: "Venturi Efficiency Information",
            content: `
                <p role="text">This gauge shows the calculated efficiency of the Venturi meter.</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>Percentage of pressure recovered after the throat</li>
                    <li>Higher values indicate better efficiency</li>
                    <li>Efficiency depends on design and flow conditions</li>
                    <li>Below 70% may indicate issues</li>
                </ul>
                <p role="text"><strong>Normal Range:</strong> Typically 75-95% for well-designed Venturi meters</p>
            `
        },
        reynolds: {
            title: "Reynolds Number Information",
            content: `
                <p role="text">This chart shows the Reynolds number, indicating flow regime.</p>
                <p role="text"><strong>How to read:</strong></p>
                <ul>
                    <li>Below 2000: Laminar flow (smooth)</li>
                    <li>2000-4000: Transitional flow</li>
                    <li>Above 4000: Turbulent flow</li>
                    <li>Venturi meters work best in turbulent flow</li>
                </ul>
                <p role="text"><strong>Note:</strong> Calculated using throat diameter and current flow rate.</p>
            `
        }
    };
    
    // Add info buttons to each card
    // Add info buttons to each card
document.querySelectorAll('.card').forEach(card => {
    // Skip system status and configuration cards
    if (!card.querySelector('.chart-container') && !card.querySelector('.chart-dual') && !card.querySelector('.gauge-container')) {
        return;
    }
    
    const cardTitle = card.querySelector('.card-title').textContent;
    let chartType = '';
    
    if (cardTitle.includes('Pressure 1')) chartType = 'pressure1';
    else if (cardTitle.includes('Pressure 2')) chartType = 'pressure2';
    else if (cardTitle.includes('Differential')) chartType = 'diffPressure';
    else if (cardTitle.includes('Flow Rate') && !cardTitle.includes('Gauge')) chartType = 'flowRate';
    else if (cardTitle.includes('Comparison')) chartType = 'pressureComp';
    else if (cardTitle.includes('Gauge')) chartType = 'flowGauge';
    else if (cardTitle.includes('Efficiency')) chartType = 'efficiency';
    else if (cardTitle.includes('Reynolds')) chartType = 'reynolds';
    
    if (chartType) {
        const infoButton = document.createElement('button');
        infoButton.className = 'card-info-button';
        infoButton.innerHTML = 'i';
        infoButton.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent event bubbling
            openModal(chartType, card);
        });
        card.style.position = 'relative';
        card.appendChild(infoButton);
        
        // Store the chart type on the card element for reference
        card.dataset.chartType = chartType;
    }
});
    
// Function to check if device is mobile
function checkMobile() {
    isMobile = window.innerWidth <= 768;
    return isMobile;
}

// Window resize listener to update mobile status
window.addEventListener('resize', checkMobile);

// Function to clone a card and position it above the modal
function cloneAndPositionCard(card) {
    // Get the original card's styles and position
    const cardRect = card.getBoundingClientRect();
    const computedStyle = window.getComputedStyle(card);
    
    // Create a clone of the card
    const cardClone = card.cloneNode(true);
    cardClone.classList.add('card-clone');
    cardClone.style.width = `${cardRect.width}px`;
    cardClone.style.height = `${cardRect.height}px`;
    cardClone.style.top = `${cardRect.top}px`;
    cardClone.style.left = `${cardRect.left}px`;
    cardClone.style.backgroundColor = computedStyle.backgroundColor;
    
    // Find all canvas elements in the original card
    const originalCanvases = card.querySelectorAll('canvas');
    const cloneCanvases = cardClone.querySelectorAll('canvas');
    
    // For each canvas in the original, copy its content to the cloned canvas
    originalCanvases.forEach((originalCanvas, index) => {
        if (index < cloneCanvases.length) {
            const cloneCanvas = cloneCanvases[index];
            
            // Set the same dimensions
            cloneCanvas.width = originalCanvas.width;
            cloneCanvas.height = originalCanvas.height;
            
            // Copy the canvas content
            const ctx = cloneCanvas.getContext('2d');
            ctx.drawImage(originalCanvas, 0, 0);
        }
    });
    
    // Mark the original card
    card.classList.add('being-cloned');
    
    // Append the clone to the body
    document.body.appendChild(cardClone);
    
    // Animate the clone to position above the modal
    setTimeout(() => {
        // For mobile, position the card to float at the top of the screen
        if (checkMobile()) {
            // Calculate position based on modal position
            const modalTop = parseFloat(window.getComputedStyle(infoModal).top) || cardRect.bottom + 20;
            cardClone.style.top = `${modalTop - cardRect.height - 20}px`; // Position above the modal with 20px gap
        } else {
            // For desktop, just move it up a bit
            cardClone.style.top = `${cardRect.top - 20}px`;
        }
    }, 10);
    
    return cardClone;
}
 // An alternative approach: Instead of cloning the card with charts
// We can simply position the original card above the modal

function positionCardAboveModal(card) {
    // Store original position
    if (!card.dataset.originalPosition) {
        const rect = card.getBoundingClientRect();
        card.dataset.originalPosition = JSON.stringify({
            position: card.style.position,
            top: card.style.top,
            left: card.style.left,
            zIndex: card.style.zIndex,
            transform: card.style.transform
        });
        
        // Make card float above modal
        card.style.position = 'fixed';
        card.style.top = `${rect.top}px`;
        card.style.left = `${rect.left}px`;
        card.style.zIndex = '1001';
        
        // Animate the card upward
        setTimeout(() => {
            if (checkMobile()) {
                // For mobile, position above modal
                const modalTop = parseFloat(window.getComputedStyle(infoModal).top) || window.innerHeight * 0.4;
                card.style.top = `${modalTop - rect.height - 20}px`;
            } else {
                // For desktop, just move it up a bit
                card.style.top = `${rect.top - 20}px`;
            }
            card.style.transform = 'scale(1.02)';
            card.style.boxShadow = '0 8px 20px rgba(0, 0, 255, 0.3)';
        }, 10);
    }
}

function resetCardPosition(card) {
    if (card.dataset.originalPosition) {
        const original = JSON.parse(card.dataset.originalPosition);
        
        // Animate back to original position
        const rect = card.getBoundingClientRect();
        card.style.transition = 'all 0.3s ease';
        
        setTimeout(() => {
            card.style.position = original.position || '';
            card.style.top = original.top || '';
            card.style.left = original.left || '';
            card.style.zIndex = original.zIndex || '';
            card.style.transform = original.transform || '';
            card.style.boxShadow = '';
            
            // Clean up
            delete card.dataset.originalPosition;
        }, 300);
    }
}

// Modified openModal function
function openModal(chartType, card) {
    const info = chartInfo[chartType];
    if (!info) return;
    
    // Set active card
    activeCard = card;
    
    // Position card above modal instead of cloning
    positionCardAboveModal(card);
    
    modalTitle.textContent = info.title;
    modalContent.innerHTML = info.content;
    
    // Show elements before activating
    modalOverlay.style.display = 'block';
    infoModal.style.display = 'flex';
    
    // Force reflow before adding active class
    void modalOverlay.offsetWidth;
    void infoModal.offsetWidth;
    
    modalOverlay.classList.add('active');
    infoModal.classList.add('active');
    
    // Prevent body scrolling when modal is open
    document.body.style.overflow = 'hidden';
}

// Modified closeModal function
function closeModal() {
    modalOverlay.classList.remove('active');
    infoModal.classList.remove('active');
    
    // Reset the original card position
    if (activeCard) {
        resetCardPosition(activeCard);
        activeCard = null;
    }
    
    infoModal.style.transform = 'translateY(0)';
    
    // Wait for transition to complete before hiding
    setTimeout(() => {
        modalOverlay.style.display = 'none';
        infoModal.style.display = 'none';
        infoModal.style.transform = '';
        document.body.style.overflow = '';
    }, 300);
}
 
// Event listeners
modalOverlay.addEventListener('click', closeModal);
modalClose.addEventListener('click', closeModal);

// Escape key to close modal
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && activeCard) {
        closeModal();
    }
});

// Swipe to close functionality for mobile
let startY = 0;
let currentY = 0;
let isDragging = false;

modalDragHandle.addEventListener('touchstart', (e) => {
    startY = e.touches[0].clientY;
    currentY = startY;
    isDragging = true;
    e.preventDefault();
}, { passive: false });

window.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    currentY = e.touches[0].clientY;
    
    // Calculate how much the modal has been dragged down
    const deltaY = currentY - startY;
    
    // Only move the modal down if dragging down
    if (deltaY > 0) {
        infoModal.style.transform = `translateY(${deltaY}px)`;
    }
    e.preventDefault();
}, { passive: false });

window.addEventListener('touchend', () => {
    if (!isDragging) return;
    isDragging = false;
    
    // Calculate how much the modal has been dragged down
    const deltaY = currentY - startY;
    
    // If dragged enough, close the modal
    if (deltaY > 100) {
        closeModal();
        infoModal.style.transform = 'translateY(0)';
    } else {
        // Otherwise, snap back to open position
        infoModal.style.transform = 'translateY(0)';
    }
});
</script>
  <script>
        // Add this to your CSS or in a style tag
        document.addEventListener('DOMContentLoaded', function() {
            // Focus management for modal
            const modal = document.getElementById('infoModal');
            if (modal) {
                modal.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeModal();
                    }
                });
            }
            
            // Ensure focus is managed when content updates
            function updateLiveRegion(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                    element.setAttribute('aria-atomic', 'true');
                }
            }
        });
    </script>
 </body>
 </html>
